#%Module
# singularity

proc ModulesHelp { } {
   puts stderr "Provide a user environment suitable for running Singularity containers"
}
module-whatis "Provide a user environment suitable for running Singularity containers"

set appname singularity
set machine titan
set version 2.2.1

# Ensure that the correct environment variables are picked up in the container
# assuming TitanPrep.sh has been run on the image

if { [ is-loaded PrgEnv-pgi ] } {
  module swap PrgEnv-pgi PrgEnv-gnu
}
if { [ is-loaded PrgEnv-intel ] } {
  module swap PrgEnv-intel PrgEnv-gnu
}
if { [ is-loaded PrgEnv-cray ] } {
  module swap PrgEnv-cray PrgEnv-gu
}
module swap gcc gcc/4.9.3

setenv SYSUTILS_DEFAULT_DIR [exec readlink -f /opt/cray/sysutils/default]
setenv WLM_DEFAULT_DIR [exec readlink -f /opt/cray/wlm_detect/default]
setenv CRAY_NVIDIA_DRIVER_LIB_DIR [exec readlink -f /opt/cray/nvidia/default/lib64]
setenv CRAY_NVIDIA_DRIVER_BIN_DIR [exec readlink -f /opt/cray/nvidia/default/bin]

setenv SINGULARITY_MODULE_LOADED 1

#
##-- end
#

